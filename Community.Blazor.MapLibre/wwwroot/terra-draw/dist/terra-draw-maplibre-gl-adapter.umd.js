!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("terra-draw")):"function"==typeof define&&define.amd?define(["exports","terra-draw"],t):t((e||self).terraDrawMaplibreGlAdapter={},e.terraDraw)}(this,function(e,t){function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}e.TerraDrawMapLibreGLAdapter=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this)._renderBeforeLayerId=void 0,i._prefixId=void 0,i._initialDragPan=void 0,i._initialDragRotate=void 0,i._nextRender=void 0,i._map=void 0,i._container=void 0,i.changedIds={deletion:!1,points:!1,linestrings:!1,polygons:!1,styling:!1},i._map=t.map,i._container=i._map.getContainer(),i._initialDragRotate=i._map.dragRotate.isEnabled(),i._initialDragPan=i._map.dragPan.isEnabled(),i._renderBeforeLayerId=t.renderBelowLayerId,i._prefixId=t.prefixId||"td",i}var r,n;n=e,(r=t).prototype=Object.create(n.prototype),r.prototype.constructor=r,i(r,n);var o=t.prototype;return o.hashCode=function(e){for(var t=0,i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return Math.abs(t)},o.resizeImage=function(e,t,i,r){var n=new Image;n.crossOrigin="anonymous",n.onload=function(){var e=document.createElement("canvas");e.width=t,e.height=i;var o=e.getContext("2d");if(!o)throw new Error("Could not get canvas context");o.drawImage(n,0,0,t,i);var a=e.toDataURL();r(a)},n.src=e},o._addGeoJSONSource=function(e,t){this._map.addSource(e,{type:"geojson",data:{type:"FeatureCollection",features:t},tolerance:0})},o._addFillLayer=function(e){return this._map.addLayer({id:e,source:e,type:"fill",layout:{"fill-sort-key":["get","zIndex"]},paint:{"fill-color":["get","polygonFillColor"],"fill-opacity":["get","polygonFillOpacity"]}})},o._addFillOutlineLayer=function(e){return this._map.addLayer({id:e+"-outline",source:e,type:"line",layout:{"line-sort-key":["get","zIndex"]},paint:{"line-width":["get","polygonOutlineWidth"],"line-color":["get","polygonOutlineColor"]}})},o._addLineLayer=function(e){return this._map.addLayer({id:e,source:e,type:"line",layout:{"line-sort-key":["get","zIndex"]},paint:{"line-width":["get","lineStringWidth"],"line-color":["get","lineStringColor"]}})},o._addPointLayer=function(e){return this._map.addLayer({id:e,source:e,type:"circle",layout:{"circle-sort-key":["get","zIndex"]},paint:{"circle-stroke-color":["get","pointOutlineColor"],"circle-stroke-width":["get","pointOutlineWidth"],"circle-radius":["get","pointWidth"],"circle-color":["get","pointColor"]}})},o._addMarkerLayer=function(e){return this._map.addLayer({id:e+"-marker",source:e,type:"symbol",filter:["has","markerId"],layout:{"icon-image":["image",["get","markerId"]],"icon-anchor":"bottom","icon-allow-overlap":!0}})},o._addLayer=function(e,t){"Point"===t&&(this._addPointLayer(e),this._addMarkerLayer(e)),"LineString"===t&&this._addLineLayer(e),"Polygon"===t&&(this._addFillLayer(e),this._addFillOutlineLayer(e))},o._addGeoJSONLayer=function(e,t){var i=this._prefixId+"-"+e.toLowerCase();return this._addGeoJSONSource(i,t),this._addLayer(i,e),i},o._setGeoJSONLayerData=function(e,t){var i=this._prefixId+"-"+e.toLowerCase();return this._map.getSource(i).setData({type:"FeatureCollection",features:t}),i},o.updateChangedIds=function(e){var t=this;[].concat(e.updated,e.created).forEach(function(e){"Point"===e.geometry.type?t.changedIds.points=!0:"LineString"===e.geometry.type?t.changedIds.linestrings=!0:"Polygon"===e.geometry.type&&(t.changedIds.polygons=!0)}),e.deletedIds.length>0&&(this.changedIds.deletion=!0),0===e.created.length&&0===e.updated.length&&0===e.deletedIds.length&&(this.changedIds.styling=!0)},o.getLngLatFromEvent=function(e){var t=this._container.getBoundingClientRect();return this.unproject(e.clientX-t.left,e.clientY-t.top)},o.getMapEventElement=function(){return this._map.getCanvas()},o.setDraggability=function(e){e?(this._initialDragRotate&&this._map.dragRotate.enable(),this._initialDragPan&&this._map.dragPan.enable()):(this._initialDragRotate&&this._map.dragRotate.disable(),this._initialDragPan&&this._map.dragPan.disable())},o.project=function(e,t){var i=this._map.project({lng:e,lat:t});return{x:i.x,y:i.y}},o.unproject=function(e,t){var i=this._map.unproject({x:e,y:t});return{lng:i.lng,lat:i.lat}},o.setCursor=function(e){var t=this._map.getCanvas();"unset"===e?t.style.removeProperty("cursor"):t.style.cursor=e},o.setDoubleClickToZoom=function(e){e?this._map.doubleClickZoom.enable():this._map.doubleClickZoom.disable()},o.render=function(e,t){var i=this;this.updateChangedIds(e),this._nextRender&&cancelAnimationFrame(this._nextRender),this._nextRender=requestAnimationFrame(function(){if(i._currentModeCallbacks){for(var r=[].concat(e.created,e.updated,e.unchanged),n=[],o=[],a=[],d=function(){var e=r[l],d=e.properties,s=t[d.mode](e);if(d.zIndex=s.zIndex,d.zIndex=s.zIndex,"Point"===e.geometry.type){if(d.pointColor=s.pointColor,d.pointOutlineColor=s.pointOutlineColor,d.pointOutlineWidth=s.pointOutlineWidth,d.pointWidth=s.pointWidth,s.markerUrl&&s.markerWidth&&s.markerHeight){var p="marker-"+i.hashCode(s.markerUrl);i._map.hasImage(p)||i.resizeImage(s.markerUrl,s.markerWidth,s.markerHeight,function(e){i._map.loadImage(e).then(function(e){i._map.hasImage(p)||i._map.addImage(p,e.data)})}),d.markerId=p,d.pointWidth=0}n.push(e)}else"LineString"===e.geometry.type?(d.lineStringColor=s.lineStringColor,d.lineStringWidth=s.lineStringWidth,o.push(e)):"Polygon"===e.geometry.type&&(d.polygonFillColor=s.polygonFillColor,d.polygonFillOpacity=s.polygonFillOpacity,d.polygonOutlineColor=s.polygonOutlineColor,d.polygonOutlineWidth=s.polygonOutlineWidth,a.push(e))},l=0;l<r.length;l++)d();var s=i.changedIds.deletion||i.changedIds.styling,p=s||i.changedIds.linestrings,c=s||i.changedIds.polygons;(s||i.changedIds.points)&&i._setGeoJSONLayerData("Point",n),p&&i._setGeoJSONLayerData("LineString",o),c&&i._setGeoJSONLayerData("Polygon",a),i.changedIds={points:!1,linestrings:!1,polygons:!1,deletion:!1,styling:!1}}})},o.clear=function(){this._currentModeCallbacks&&(this._currentModeCallbacks.onClear(),this._nextRender&&(cancelAnimationFrame(this._nextRender),this._nextRender=void 0),this._setGeoJSONLayerData("Point",[]),this._setGeoJSONLayerData("LineString",[]),this._setGeoJSONLayerData("Polygon",[]))},o.getCoordinatePrecision=function(){return e.prototype.getCoordinatePrecision.call(this)},o.unregister=function(){e.prototype.unregister.call(this),this.changedIds={points:!1,linestrings:!1,polygons:!1,deletion:!1,styling:!1},this._map.removeLayer(this._prefixId+"-point"),this._map.removeLayer(this._prefixId+"-point-marker"),this._map.removeSource(this._prefixId+"-point"),this._map.removeLayer(this._prefixId+"-linestring"),this._map.removeSource(this._prefixId+"-linestring"),this._map.removeLayer(this._prefixId+"-polygon"),this._map.removeLayer(this._prefixId+"-polygon-outline"),this._map.removeSource(this._prefixId+"-polygon")},o.register=function(t){var i;e.prototype.register.call(this,t);var r,n=this._addGeoJSONLayer("Polygon",[]),o=this._addGeoJSONLayer("LineString",[]),a=this._addGeoJSONLayer("Point",[]);this._renderBeforeLayerId&&(this._map.moveLayer(a,this._renderBeforeLayerId),this._map.moveLayer(o,a),this._map.moveLayer(n+"-outline",o),this._map.moveLayer(n,o)),null!=(i=this._currentModeCallbacks)&&i.onReady&&(null==(r=this._currentModeCallbacks)||r.onReady())},t}(t.TerraDrawExtend.TerraDrawBaseAdapter)});
//# sourceMappingURL=terra-draw-maplibre-gl-adapter.umd.js.map
